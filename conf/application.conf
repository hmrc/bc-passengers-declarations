# Copyright 2021 HM Revenue & Customs
#

include "backend.conf"

appName = bc-passengers-declarations

play.application.loader = "uk.gov.hmrc.play.bootstrap.ApplicationLoader"
play.http.requestHandler = "uk.gov.hmrc.play.bootstrap.http.RequestHandler"
play.http.filters = "uk.gov.hmrc.play.bootstrap.filters.MicroserviceFilters"
play.http.errorHandler = "uk.gov.hmrc.play.bootstrap.http.JsonErrorHandler"

play.modules.enabled += "uk.gov.hmrc.play.bootstrap.AuditModule"
play.modules.enabled += "uk.gov.hmrc.play.bootstrap.graphite.GraphiteMetricsModule"
play.modules.enabled += "uk.gov.hmrc.play.bootstrap.MicroserviceModule"
play.modules.enabled += "uk.gov.hmrc.play.bootstrap.HttpClientModule"
play.modules.enabled += "play.modules.reactivemongo.ReactiveMongoModule"
play.modules.enabled += "config.HmrcModule"

play.crypto.secret="pfQeCfb7WcfBKNcCYUczPCMSYDftywNgXgMiYf4nHYjfl2Elp7Qy9rbF1qehY8ut"

application.langs="en"

# !!!WARNING!!! DO NOT CHANGE THIS ROUTER
application.router=prod.Routes

logger.root        = ERROR
logger.play        = INFO
logger.application = INFO


metrics {
  name         = ${appName}
  rateUnit     = SECONDS
  durationUnit = SECONDS
  showSamples  = true
  jvm          = true
  enabled      = false
}

auditing {
  enabled = false
  traceRequests = true
  consumer.baseUri {
    host = localhost
    port = 8100
  }
}

mongodb {

  uri = "mongodb://localhost:27017/bc-passengers-declarations"
}

mongo-async-driver {
  akka {
    loglevel = WARNING
  }
}

microservice {

  metrics {
    graphite {
        host    = graphite
        port    = 2003
        prefix  = play.${appName}.
        enabled = false
    }
  }

  services {

    email {
           sendEmailURL {
             host = localhost
             port = 8300
           }
           domain = transactionengine
           addressFirst = "hmrc-ddcn-team-passengers@digital.hmrc.gov.uk"
           addressSecond = "hmrc-ddcn-team-passengers@digital.hmrc.gov.uk"
         }

    des {

      protocol = http
      host     = localhost
      port     = 9074
      bearer-token = "changeme"

      circuit-breaker {
        max-failures  = 5
        call-timeout  = 60 seconds
        reset-timeout = 5 minutes
      }
    }
  }
}

locks {
  ttl = 300
}

declarations {

  payment-no-response-timeout = 14.days
  schemas {
    current = "schema-v1-1-5.json"
    request = "declarationsRequestSchema.json"
  }
}

features {
  disable-zero-pound-email = false
}

workers {

  payment-timeout-worker {

    initial-delay = 0.seconds
    interval      = 1.day
    parallelism   = 4
  }

  amendment-payment-timeout-worker {

      initial-delay = 0.seconds
      interval      = 12.hours
      parallelism   = 4
    }

  declaration-submission-worker {

    initial-delay = 0.seconds
    interval      = 30.minutes
    parallelism   = 4

    throttle {
      elements = 1
      per      = 1.second
    }
  }

  amendment-submission-worker {

      initial-delay = 0.seconds
      interval      = 17.minutes
      parallelism   = 4

      throttle {
        elements = 1
        per      = 1.second
      }
    }

    declaration-deletion-worker {

      initial-delay = 0.seconds
      interval      = 23.minutes
      parallelism   = 4
      timeToHold   = 3.days
    }

  failed-submission-worker {
    parallelism = 4
  }

  amendment-failed-submission-worker {
    parallelism = 4
  }


  metrics-worker {

    initial-delay = 0.seconds
    interval      = 60.seconds
  }
}
